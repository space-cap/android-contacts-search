# 연락처 검색 앱 작업 계획서

## 프로젝트 개요

### 목적
안드로이드 기기의 연락처 정보를 읽어와 리스트로 표시하고, 한글 초성 검색 기능을 제공하는 앱을 개발합니다.

### 기술 스택
- **언어**: Kotlin
- **UI 프레임워크**: Jetpack Compose
- **아키텍처**: MVVM (Model-View-ViewModel)
- **최소 SDK**: 24 (Android 7.0)
- **타겟 SDK**: 36

### 주요 기능
1. **연락처 읽기**: 기기의 연락처 정보를 읽어옵니다
2. **연락처 리스트 표시**: 읽어온 연락처를 리스트 형태로 표시합니다
3. **초성 검색**: 한글 이름의 초성으로 연락처를 검색합니다 (예: "ㄱㅎㄷ" → "김현도")
4. **권한 처리**: 연락처 읽기 권한을 안전하게 요청하고 처리합니다

---

## 구현 계획

### 1. 프로젝트 구조

```
app/src/main/java/com/ezlevup/contactssearch/
├── data/
│   ├── model/
│   │   └── Contact.kt                 # 연락처 데이터 모델
│   └── repository/
│       └── ContactRepository.kt       # 연락처 데이터 접근 계층
├── domain/
│   └── usecase/
│       └── GetContactsUseCase.kt      # 연락처 가져오기 비즈니스 로직
├── presentation/
│   ├── viewmodel/
│   │   └── ContactViewModel.kt        # 연락처 화면 ViewModel
│   └── ui/
│       ├── ContactListScreen.kt       # 연락처 리스트 화면
│       ├── components/
│       │   ├── ContactItem.kt         # 연락처 아이템 컴포저블
│       │   └── SearchBar.kt           # 검색바 컴포저블
│       └── permission/
│           └── PermissionScreen.kt    # 권한 요청 화면
├── util/
│   ├── KoreanUtils.kt                 # 한글 초성 처리 유틸리티
│   └── PermissionUtils.kt             # 권한 처리 유틸리티
└── MainActivity.kt                     # 메인 액티비티
```

### 2. 필요한 의존성

다음 라이브러리들을 `gradle/libs.versions.toml`과 `app/build.gradle.kts`에 추가해야 합니다:

#### 추가할 의존성
- **ViewModel & LiveData**: `androidx.lifecycle:lifecycle-viewmodel-compose`
- **Permissions (Accompanist)**: `com.google.accompanist:accompanist-permissions`
- **Navigation Compose**: `androidx.navigation:navigation-compose` (화면 전환용)

### 3. 권한 설정

`AndroidManifest.xml`에 다음 권한을 추가해야 합니다:

```xml
<uses-permission android:name="android.permission.READ_CONTACTS" />
```

---

## 상세 구현 단계

### Phase 1: 기본 설정 및 의존성 추가

#### 1.1 의존성 추가
- `gradle/libs.versions.toml`에 버전 정의 추가
- `app/build.gradle.kts`에 라이브러리 추가
- Gradle 동기화 실행

#### 1.2 권한 설정
- `AndroidManifest.xml`에 `READ_CONTACTS` 권한 추가

---

### Phase 2: 데이터 레이어 구현

#### 2.1 Contact 데이터 모델 생성
**파일**: `data/model/Contact.kt`

연락처 정보를 담을 데이터 클래스를 정의합니다:
- `id`: 연락처 고유 ID
- `name`: 이름
- `phoneNumber`: 전화번호
- `photoUri`: 프로필 사진 URI (선택사항)

#### 2.2 ContactRepository 구현
**파일**: `data/repository/ContactRepository.kt`

ContentResolver를 사용하여 연락처 데이터를 읽어오는 로직을 구현합니다:
- `getContacts()`: 모든 연락처를 가져오는 함수
- ContentProvider를 통해 연락처 데이터 쿼리
- Cursor를 사용하여 데이터 파싱
- Contact 객체 리스트로 변환

**쿼리할 컬럼**:
- `ContactsContract.CommonDataKinds.Phone.CONTACT_ID`
- `ContactsContract.CommonDataKinds.Phone.DISPLAY_NAME`
- `ContactsContract.CommonDataKinds.Phone.NUMBER`
- `ContactsContract.CommonDataKinds.Phone.PHOTO_URI`

---

### Phase 3: 유틸리티 구현

#### 3.1 한글 초성 처리 유틸리티
**파일**: `util/KoreanUtils.kt`

한글 초성 검색을 위한 유틸리티 함수들을 구현합니다:

**주요 함수**:
1. `getChosung(text: String): String`
   - 한글 문자열을 초성으로 변환
   - 예: "김현도" → "ㄱㅎㄷ"
   
2. `matchesChosung(name: String, query: String): Boolean`
   - 이름이 초성 검색어와 일치하는지 확인
   - 부분 일치도 지원 (예: "ㄱㅎ"로 "김현도" 검색 가능)

**한글 초성 추출 로직**:
- 한글 유니코드 범위: `0xAC00` ~ `0xD7A3`
- 초성 계산: `(char - 0xAC00) / 588`
- 초성 배열: `['ㄱ', 'ㄲ', 'ㄴ', 'ㄷ', 'ㄸ', 'ㄹ', 'ㅁ', 'ㅂ', 'ㅃ', 'ㅅ', 'ㅆ', 'ㅇ', 'ㅈ', 'ㅉ', 'ㅊ', 'ㅋ', 'ㅌ', 'ㅍ', 'ㅎ']`

#### 3.2 권한 처리 유틸리티
**파일**: `util/PermissionUtils.kt`

권한 상태 확인 및 처리를 위한 유틸리티 함수들을 구현합니다:
- `hasContactsPermission(context: Context): Boolean`
- 권한 상태 확인 로직

---

### Phase 4: 도메인 레이어 구현

#### 4.1 GetContactsUseCase 구현
**파일**: `domain/usecase/GetContactsUseCase.kt`

연락처를 가져오는 비즈니스 로직을 캡슐화합니다:
- Repository에서 연락처 데이터 가져오기
- 정렬 로직 적용 (이름 순)
- 에러 처리

---

### Phase 5: 프레젠테이션 레이어 구현

#### 5.1 ContactViewModel 구현
**파일**: `presentation/viewmodel/ContactViewModel.kt`

UI 상태 관리 및 비즈니스 로직 연결:

**상태 관리**:
- `contacts: StateFlow<List<Contact>>` - 전체 연락처 리스트
- `filteredContacts: StateFlow<List<Contact>>` - 검색 필터링된 연락처
- `searchQuery: StateFlow<String>` - 검색어
- `isLoading: StateFlow<Boolean>` - 로딩 상태
- `error: StateFlow<String?>` - 에러 메시지

**주요 함수**:
- `loadContacts()` - 연락처 로드
- `onSearchQueryChange(query: String)` - 검색어 변경 처리
- `filterContacts(query: String)` - 초성 검색 필터링

**검색 로직**:
1. 검색어가 비어있으면 전체 리스트 표시
2. 검색어가 초성인 경우 초성 매칭
3. 검색어가 일반 텍스트인 경우 이름에 포함 여부 확인

#### 5.2 UI 컴포넌트 구현

##### 5.2.1 SearchBar 컴포저블
**파일**: `presentation/ui/components/SearchBar.kt`

검색 입력을 위한 UI 컴포넌트:
- TextField를 사용한 검색 입력
- 검색 아이콘 표시
- 입력값 초기화 버튼
- 힌트 텍스트: "이름 또는 초성으로 검색 (예: ㄱㅎㄷ)"

##### 5.2.2 ContactItem 컴포저블
**파일**: `presentation/ui/components/ContactItem.kt`

개별 연락처 아이템 UI:
- 프로필 이미지 (있는 경우) 또는 기본 아이콘
- 이름 표시
- 전화번호 표시
- 클릭 이벤트 처리 (전화 걸기 등)

##### 5.2.3 ContactListScreen 컴포저블
**파일**: `presentation/ui/ContactListScreen.kt`

메인 연락처 리스트 화면:
- SearchBar 컴포넌트
- LazyColumn을 사용한 연락처 리스트
- 로딩 상태 표시 (CircularProgressIndicator)
- 에러 상태 표시
- 빈 상태 표시 ("연락처가 없습니다")
- 검색 결과 없음 표시

##### 5.2.4 PermissionScreen 컴포저블
**파일**: `presentation/ui/permission/PermissionScreen.kt`

권한 요청 화면:
- 권한이 필요한 이유 설명
- 권한 요청 버튼
- Accompanist Permissions 라이브러리 사용
- 권한 거부 시 설정으로 이동 안내

---

### Phase 6: 메인 액티비티 통합

#### 6.1 MainActivity 수정
**파일**: `MainActivity.kt`

앱의 진입점 구성:
- 권한 상태 확인
- 권한이 있으면 ContactListScreen 표시
- 권한이 없으면 PermissionScreen 표시
- Navigation 설정 (선택사항)

---

## 검증 계획

### 1. 빌드 검증
```bash
./gradlew clean build
```
- 프로젝트가 에러 없이 빌드되는지 확인

### 2. 기능 테스트

#### 2.1 연락처 읽기 기능
**수동 테스트 절차**:
1. 앱 설치 및 실행
2. 연락처 권한 요청 팝업에서 "허용" 선택
3. 연락처 리스트가 표시되는지 확인
4. 기기의 연락처 앱과 비교하여 데이터가 정확한지 확인

#### 2.2 초성 검색 기능
**수동 테스트 절차**:
1. 검색바에 초성 입력 (예: "ㄱㅎㄷ")
2. 해당 초성으로 시작하는 이름들이 필터링되는지 확인
3. 부분 일치 검색 테스트 (예: "ㄱㅎ"로 "김현도" 검색)
4. 검색어 삭제 시 전체 리스트가 다시 표시되는지 확인

#### 2.3 권한 처리
**수동 테스트 절차**:
1. 앱 삭제 후 재설치
2. 권한 요청 화면이 표시되는지 확인
3. "거부" 선택 시 적절한 안내 메시지 표시 확인
4. 설정에서 권한 부여 후 앱 재시작 시 정상 작동 확인

### 3. UI/UX 검증
- 로딩 상태가 적절히 표시되는지 확인
- 에러 상태가 사용자 친화적으로 표시되는지 확인
- 스크롤 성능 확인 (많은 연락처가 있는 경우)
- 검색 반응 속도 확인

---

## 예상 이슈 및 해결 방안

### 1. 권한 거부 시 처리
**문제**: 사용자가 권한을 거부하면 앱을 사용할 수 없음
**해결**: 
- 권한이 필요한 이유를 명확히 설명
- 설정으로 이동하는 버튼 제공
- 우아한 에러 처리

### 2. 대량의 연락처 처리
**문제**: 연락처가 많을 경우 성능 저하
**해결**:
- LazyColumn 사용으로 가상화 적용
- 코루틴을 사용한 비동기 처리
- 필요시 페이징 구현

### 3. 중복 전화번호
**문제**: 한 연락처에 여러 전화번호가 있을 수 있음
**해결**:
- 대표 전화번호 하나만 표시
- 또는 연락처를 확장하여 모든 번호 표시

### 4. 초성 검색 정확도
**문제**: 복잡한 한글 조합 처리
**해결**:
- 유니코드 기반 정확한 초성 추출 알고리즘 사용
- 영문 이름도 함께 검색할 수 있도록 확장

---

## 추가 개선 사항 (선택사항)

### 1. 즐겨찾기 기능
- 자주 연락하는 사람을 즐겨찾기로 등록
- Room Database 사용

### 2. 최근 연락처
- 최근 통화/문자 기록 연동
- CallLog ContentProvider 사용

### 3. 그룹별 정렬
- 초성별 그룹 헤더 표시
- Sticky Header 구현

### 4. 다크 모드 지원
- Material3 테마 활용
- 시스템 설정 연동

### 5. 연락처 상세 화면
- 전화 걸기, 문자 보내기 등 액션 추가
- Intent를 통한 기본 앱 연동

---

## 타임라인 예상

| 단계 | 예상 시간 | 설명 |
|------|----------|------|
| Phase 1 | 30분 | 의존성 추가 및 권한 설정 |
| Phase 2 | 1-2시간 | 데이터 레이어 구현 |
| Phase 3 | 1-2시간 | 유틸리티 구현 (특히 초성 로직) |
| Phase 4 | 30분 | UseCase 구현 |
| Phase 5 | 2-3시간 | ViewModel 및 UI 구현 |
| Phase 6 | 30분 | MainActivity 통합 |
| 테스트 | 1-2시간 | 기능 테스트 및 버그 수정 |
| **총 예상 시간** | **6-10시간** | 개발자 숙련도에 따라 변동 |

---

## 참고 자료

### Android 공식 문서
- [Contacts Provider](https://developer.android.com/guide/topics/providers/contacts-provider)
- [Request Runtime Permissions](https://developer.android.com/training/permissions/requesting)
- [Jetpack Compose](https://developer.android.com/jetpack/compose)

### 한글 처리
- [한글 유니코드 표](https://ko.wikipedia.org/wiki/%ED%95%9C%EA%B8%80_%EC%9C%A0%EB%8B%88%EC%BD%94%EB%93%9C)
- 초성 추출 알고리즘 참고

### 라이브러리
- [Accompanist Permissions](https://google.github.io/accompanist/permissions/)
- [Jetpack Compose Navigation](https://developer.android.com/jetpack/compose/navigation)

---

## 결론

이 계획서는 연락처 검색 앱의 전체 구현 과정을 단계별로 정리한 것입니다. 각 단계를 순차적으로 진행하면서 테스트를 병행하면 안정적인 앱을 개발할 수 있습니다.

특히 한글 초성 검색 기능은 이 앱의 핵심 기능이므로, `KoreanUtils.kt`의 구현에 충분한 시간을 투자하고 다양한 테스트 케이스로 검증하는 것이 중요합니다.
