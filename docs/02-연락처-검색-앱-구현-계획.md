# 연락처 검색 앱 구현 계획

## 개요

안드로이드 기기의 연락처 정보를 읽어와 리스트로 표시하고, 한글 초성 검색 기능을 제공하는 앱을 구현합니다.

**주요 기능**:
- 연락처 읽기 (ContentProvider 사용)
- 연락처 리스트 표시 (Jetpack Compose)
- 한글 초성 검색 (예: "ㄱㅎㄷ" → "김현도")
- 연락처 읽기 권한 처리

---

## 사용자 리뷰 필요 사항

> [!IMPORTANT]
> **권한 처리 방식**
> 
> 이 앱은 연락처 읽기 권한(`READ_CONTACTS`)이 필수입니다. 권한이 없으면 앱의 핵심 기능을 사용할 수 없습니다.
> 
> **구현 방식**:
> - 앱 시작 시 권한 상태 확인
> - 권한이 없으면 권한 요청 화면 표시
> - 권한 거부 시 설정으로 이동하는 안내 제공
> 
> 이 방식에 동의하시나요? 다른 UX 흐름을 원하시면 알려주세요.

> [!IMPORTANT]
> **초성 검색 범위**
> 
> 초성 검색은 다음과 같이 동작합니다:
> - 완전 일치: "ㄱㅎㄷ" → "김현도" 매칭
> - 부분 일치: "ㄱㅎ" → "김현도" 매칭 (앞부분부터)
> - 일반 텍스트 검색도 함께 지원 (이름에 포함된 텍스트 검색)
> 
> 이 검색 방식이 적절한가요? 다른 요구사항이 있으면 알려주세요.

---

## 제안된 변경사항

### 1. 의존성 추가

#### [MODIFY] [libs.versions.toml](file:///c:/workdir/space-cap/AndroidStudioProjects/ContactsSearch/gradle/libs.versions.toml)

**변경 내용**:
- ViewModel Compose 라이브러리 버전 추가
- Accompanist Permissions 라이브러리 버전 추가
- Navigation Compose 라이브러리 버전 추가

**추가할 버전**:
```toml
[versions]
lifecycleViewmodelCompose = "2.10.0"
accompanistPermissions = "0.36.0"
navigationCompose = "2.8.5"
```

**추가할 라이브러리**:
```toml
[libraries]
androidx-lifecycle-viewmodel-compose = { group = "androidx.lifecycle", name = "lifecycle-viewmodel-compose", version.ref = "lifecycleViewmodelCompose" }
accompanist-permissions = { group = "com.google.accompanist", name = "accompanist-permissions", version.ref = "accompanistPermissions" }
androidx-navigation-compose = { group = "androidx.navigation", name = "navigation-compose", version.ref = "navigationCompose" }
```

#### [MODIFY] [build.gradle.kts](file:///c:/workdir/space-cap/AndroidStudioProjects/ContactsSearch/app/build.gradle.kts)

**변경 내용**:
- `dependencies` 블록에 새로운 라이브러리 추가

**추가할 의존성**:
```kotlin
implementation(libs.androidx.lifecycle.viewmodel.compose)
implementation(libs.accompanist.permissions)
implementation(libs.androidx.navigation.compose)
```

---

### 2. 권한 설정

#### [MODIFY] [AndroidManifest.xml](file:///c:/workdir/space-cap/AndroidStudioProjects/ContactsSearch/app/src/main/AndroidManifest.xml)

**변경 내용**:
- `READ_CONTACTS` 권한 추가

**추가할 권한**:
```xml
<uses-permission android:name="android.permission.READ_CONTACTS" />
```

---

### 3. 데이터 레이어

#### [NEW] [Contact.kt](file:///c:/workdir/space-cap/AndroidStudioProjects/ContactsSearch/app/src/main/java/com/ezlevup/contactssearch/data/model/Contact.kt)

**목적**: 연락처 정보를 담는 데이터 클래스

**주요 내용**:
- `id`: 연락처 고유 ID (Long)
- `name`: 이름 (String)
- `phoneNumber`: 전화번호 (String)
- `photoUri`: 프로필 사진 URI (String?, nullable)

#### [NEW] [ContactRepository.kt](file:///c:/workdir/space-cap/AndroidStudioProjects/ContactsSearch/app/src/main/java/com/ezlevup/contactssearch/data/repository/ContactRepository.kt)

**목적**: ContentProvider를 통해 연락처 데이터를 읽어오는 Repository

**주요 기능**:
- `getContacts(context: Context): List<Contact>` 함수 구현
- `ContactsContract.CommonDataKinds.Phone` ContentProvider 쿼리
- Cursor를 사용한 데이터 파싱
- 중복 제거 및 정렬 (이름 순)

**쿼리할 컬럼**:
- `CONTACT_ID`, `DISPLAY_NAME`, `NUMBER`, `PHOTO_URI`

---

### 4. 유틸리티

#### [NEW] [KoreanUtils.kt](file:///c:/workdir/space-cap/AndroidStudioProjects/ContactsSearch/app/src/main/java/com/ezlevup/contactssearch/util/KoreanUtils.kt)

**목적**: 한글 초성 처리 유틸리티

**주요 함수**:
1. `getChosung(text: String): String`
   - 한글 문자열을 초성으로 변환
   - 한글 유니코드 범위: `0xAC00` ~ `0xD7A3`
   - 초성 계산 공식: `(char - 0xAC00) / 588`
   
2. `matchesChosung(name: String, query: String): Boolean`
   - 이름이 초성 검색어와 일치하는지 확인
   - 부분 일치 지원

**초성 배열**:
```kotlin
['ㄱ', 'ㄲ', 'ㄴ', 'ㄷ', 'ㄸ', 'ㄹ', 'ㅁ', 'ㅂ', 'ㅃ', 'ㅅ', 'ㅆ', 'ㅇ', 'ㅈ', 'ㅉ', 'ㅊ', 'ㅋ', 'ㅌ', 'ㅍ', 'ㅎ']
```

---

### 5. 프레젠테이션 레이어

#### [NEW] [ContactViewModel.kt](file:///c:/workdir/space-cap/AndroidStudioProjects/ContactsSearch/app/src/main/java/com/ezlevup/contactssearch/presentation/viewmodel/ContactViewModel.kt)

**목적**: 연락처 리스트 화면의 상태 관리 및 비즈니스 로직

**상태 관리**:
- `contacts: StateFlow<List<Contact>>` - 전체 연락처
- `filteredContacts: StateFlow<List<Contact>>` - 필터링된 연락처
- `searchQuery: MutableStateFlow<String>` - 검색어
- `isLoading: StateFlow<Boolean>` - 로딩 상태
- `error: StateFlow<String?>` - 에러 메시지

**주요 함수**:
- `loadContacts(context: Context)` - 연락처 로드
- `onSearchQueryChange(query: String)` - 검색어 변경
- `filterContacts()` - 초성/일반 검색 필터링

#### [NEW] [SearchBar.kt](file:///c:/workdir/space-cap/AndroidStudioProjects/ContactsSearch/app/src/main/java/com/ezlevup/contactssearch/presentation/ui/components/SearchBar.kt)

**목적**: 검색 입력 UI 컴포넌트

**주요 요소**:
- `TextField` 또는 `OutlinedTextField` 사용
- 검색 아이콘 (leading icon)
- 입력값 초기화 버튼 (trailing icon)
- 힌트 텍스트: "이름 또는 초성으로 검색 (예: ㄱㅎㄷ)"

#### [NEW] [ContactItem.kt](file:///c:/workdir/space-cap/AndroidStudioProjects/ContactsSearch/app/src/main/java/com/ezlevup/contactssearch/presentation/ui/components/ContactItem.kt)

**목적**: 개별 연락처 아이템 UI

**주요 요소**:
- `Row` 레이아웃
- 프로필 이미지 또는 기본 아이콘 (AsyncImage 또는 Icon)
- 이름 표시 (`Text`)
- 전화번호 표시 (`Text`, 작은 글씨)
- 클릭 가능 (`Modifier.clickable`)

#### [NEW] [ContactListScreen.kt](file:///c:/workdir/space-cap/AndroidStudioProjects/ContactsSearch/app/src/main/java/com/ezlevup/contactssearch/presentation/ui/ContactListScreen.kt)

**목적**: 메인 연락처 리스트 화면

**주요 구성**:
- `Scaffold` 사용
- `TopAppBar` - 앱 제목
- `SearchBar` 컴포넌트
- `LazyColumn` - 연락처 리스트 (가상화)
- 로딩 상태 - `CircularProgressIndicator`
- 에러 상태 - 에러 메시지 표시
- 빈 상태 - "연락처가 없습니다" 메시지

#### [NEW] [PermissionScreen.kt](file:///c:/workdir/space-cap/AndroidStudioProjects/ContactsSearch/app/src/main/java/com/ezlevup/contactssearch/presentation/ui/permission/PermissionScreen.kt)

**목적**: 연락처 권한 요청 화면

**주요 구성**:
- 권한이 필요한 이유 설명
- 권한 요청 버튼
- Accompanist Permissions 라이브러리 사용
- 권한 거부 시 설정으로 이동 안내

---

### 6. 메인 액티비티

#### [MODIFY] [MainActivity.kt](file:///c:/workdir/space-cap/AndroidStudioProjects/ContactsSearch/app/src/main/java/com/ezlevup/contactssearch/MainActivity.kt)

**변경 내용**:
- 기존 `MyApp()` 호출 부분 수정
- 권한 상태에 따라 `PermissionScreen` 또는 `ContactListScreen` 표시
- `rememberPermissionState` 사용하여 권한 상태 관리

---

## 검증 계획

### 자동화된 테스트

#### 1. 빌드 검증
```bash
cd c:\workdir\space-cap\AndroidStudioProjects\ContactsSearch
./gradlew clean build
```

**예상 결과**: 빌드가 에러 없이 성공적으로 완료되어야 합니다.

#### 2. 초성 유틸리티 단위 테스트

**테스트 파일 생성**: `app/src/test/java/com/ezlevup/contactssearch/util/KoreanUtilsTest.kt`

**테스트 케이스**:
- `getChosung("김현도")` → "ㄱㅎㄷ"
- `getChosung("이영희")` → "ㅇㅇㅎ"
- `matchesChosung("김현도", "ㄱㅎㄷ")` → true
- `matchesChosung("김현도", "ㄱㅎ")` → true (부분 일치)
- `matchesChosung("김현도", "ㄴㅎ")` → false

**실행 방법**:
```bash
./gradlew test --tests "com.ezlevup.contactssearch.util.KoreanUtilsTest"
```

### 수동 검증

#### 1. 권한 처리 테스트

**절차**:
1. 앱을 에뮬레이터 또는 실제 기기에 설치
2. 앱 실행
3. 권한 요청 화면이 표시되는지 확인
4. "권한 허용" 버튼 클릭
5. 시스템 권한 팝업에서 "허용" 선택
6. 연락처 리스트 화면으로 전환되는지 확인

**예상 결과**: 권한 허용 후 연락처 리스트가 정상적으로 표시됩니다.

#### 2. 연락처 읽기 기능 테스트

**절차**:
1. 기기에 테스트용 연락처 3-5개 추가 (예: "김철수", "이영희", "박민수")
2. 앱 실행 (권한 이미 허용된 상태)
3. 연락처 리스트가 표시되는지 확인
4. 표시된 연락처가 기기의 연락처 앱과 일치하는지 확인

**예상 결과**: 모든 연락처가 이름 순으로 정렬되어 표시됩니다.

#### 3. 초성 검색 기능 테스트

**절차**:
1. 연락처 리스트 화면에서 검색바 클릭
2. 초성 "ㄱㅊㅅ" 입력
3. "김철수"가 필터링되어 표시되는지 확인
4. 검색어를 "ㄱㅊ"로 변경
5. "김철수"가 여전히 표시되는지 확인 (부분 일치)
6. 검색어를 "철수"로 변경 (일반 텍스트)
7. "김철수"가 표시되는지 확인
8. 검색어 삭제 (X 버튼 클릭)
9. 전체 연락처 리스트가 다시 표시되는지 확인

**예상 결과**: 
- 초성 검색이 정확하게 동작합니다
- 부분 일치 검색이 동작합니다
- 일반 텍스트 검색도 동작합니다
- 검색어 삭제 시 전체 리스트가 복원됩니다

#### 4. UI/UX 검증

**절차**:
1. 연락처 로딩 시 로딩 인디케이터가 표시되는지 확인
2. 많은 연락처(50개 이상)가 있을 때 스크롤 성능 확인
3. 검색 입력 시 반응 속도 확인 (즉시 필터링되는지)
4. 다크 모드에서 UI가 적절하게 표시되는지 확인

**예상 결과**: 
- 로딩 상태가 명확하게 표시됩니다
- 스크롤이 부드럽게 동작합니다
- 검색 반응이 즉각적입니다
- 다크 모드에서도 가독성이 좋습니다

---

## 구현 순서

1. **의존성 추가 및 권한 설정** (Phase 1)
2. **데이터 레이어 구현** (Phase 2)
3. **초성 유틸리티 구현 및 테스트** (Phase 3)
4. **ViewModel 구현** (Phase 4)
5. **UI 컴포넌트 구현** (Phase 5)
6. **MainActivity 통합** (Phase 6)
7. **빌드 및 수동 테스트** (검증)

각 단계를 순차적으로 진행하며, 각 단계 완료 후 빌드가 성공하는지 확인합니다.
